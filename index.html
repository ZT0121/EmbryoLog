<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Embryo Follow-Up Tracker</title>

  <!-- ✅ ICON（GitHub Pages 一定會生效） -->
  <link rel="icon" href="./favicon-32.png">
  <link rel="apple-touch-icon" href="./icon-180.png">

  <style>
    :root{
      --bg:#f6f6f6;
      --text:#2f2f2f;
      --muted:#6b6b6b;

      --d1:#E6ECEF; --d1h:#CBD7DE;
      --d2:#E8EFEA; --d2h:#CEDDD3;
      --d3:#EEEAF1; --d3h:#D9D0E1;
      --d5:#F2ECE6; --d5h:#E2D6C8;
      --d7:#EFEFEF; --d7h:#DADADA;

      --card:#ffffff;
      --line:#e2e2e2;
      --shadow:0 10px 30px rgba(0,0,0,.06);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
    }
    .wrap{max-width:1200px;margin:auto;padding:18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .title h1{margin:0;font-size:20px}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--line);font-size:12px}
    .summary{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:14px}
    .sumcard{background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px}
    .sumcard .k{font-size:12px;color:var(--muted)}
    .sumcard .v{font-size:18px;font-weight:800}

    .grid{display:grid;grid-template-columns:repeat(5,minmax(240px,1fr));gap:12px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .col{background:#fff;border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
    .colhead{padding:10px 12px;font-weight:900}
    .colbody{padding:10px}
    .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:10px;margin-bottom:10px}
    .row1{display:flex;justify-content:space-between;gap:8px}
    .name{font-weight:900}
    .mrn{font-family:var(--mono);font-size:12px;color:var(--muted)}
    .meta{font-size:12px;color:var(--muted);margin-top:6px}
    .empty{font-size:12px;color:var(--muted);padding:12px}
  </style>
</head>
<body>

<div class="wrap">
  <div class="topbar">
    <div class="title">
      <h1>Embryo Follow-Up Tracker</h1>
      <div class="pill" id="today">—</div>
    </div>
    <div class="pill" id="status">ready</div>
  </div>

  <div class="summary" id="summary"></div>

  <div class="grid">
    <div class="col"><div class="colhead" style="background:var(--d1h)">D1</div><div class="colbody" id="listD1"></div></div>
    <div class="col"><div class="colhead" style="background:var(--d2h)">D2</div><div class="colbody" id="listD2"></div></div>
    <div class="col"><div class="colhead" style="background:var(--d3h)">D3</div><div class="colbody" id="listD3"></div></div>
    <div class="col"><div class="colhead" style="background:var(--d5h)">D5</div><div class="colbody" id="listD5"></div></div>
    <div class="col"><div class="colhead" style="background:var(--d7h)">D7</div><div class="colbody" id="listD7"></div></div>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycby1aYmcPmRoLjW24rCTpFUmA9tj7Atsfzw3kFsF7og3Q03xYJfGDtFLb8mCHz9uyN4MmA/exec';
const $ = id => document.getElementById(id);

async function load(){
  $('status').textContent = 'loading…';
  const res = await fetch(API_URL);
  const data = await res.json();
  render(data);
  $('status').textContent = 'ok';
}

function render(res){
  $('today').textContent = res.today;
  renderSummary(res.summary);
  ['D1','D2','D3','D5','D7'].forEach(d=>{
    const list = res.lists[d];
    const box = $('list'+d);
    if(!list.length){
      box.innerHTML = `<div class="empty">今天沒有 ${d}</div>`;
    }else{
      box.innerHTML = list.map(t=>`
        <div class="card">
          <div class="row1">
            <div class="name">${escapeHtml(t.name).replace(/\\n/g,'<br>')}</div>
            <div class="mrn">${escapeHtml(t.mrn)}</div>
          </div>
          <div class="meta">${t.d0} · ${escapeHtml(t.doctor)} · ${escapeHtml(t.therapy)}</div>
        </div>
      `).join('');
    }
  });
}

function renderSummary(s){
  $('summary').innerHTML = Object.entries(s).map(([k,v])=>`
    <div class="sumcard"><div class="k">${k}</div><div class="v">${v}</div></div>
  `).join('');
}

function escapeHtml(s){
  return String(s??'').replace(/[&<>"']/g,m=>({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[m]));
}

load();
</script>

</body>
</html>
